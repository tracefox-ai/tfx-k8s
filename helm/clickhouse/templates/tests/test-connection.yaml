apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "clickhouse.fullname" . }}-test-connection"
  labels:
    {{- include "clickhouse.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  containers:
    - name: clickhouse-client
      image: clickhouse/clickhouse-client:{{ .Values.clickhouse.image.tag }}
      command:
        - clickhouse-client
        - --host
        - clickhouse-{{ .Values.clickhouse.cluster.name }}
        - --port
        - "9000"
        - --query
        - SELECT 1
  restartPolicy: Never
